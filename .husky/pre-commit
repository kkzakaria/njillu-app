#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Running pre-commit checks..."

# Type checking
echo "⚡ Type checking..."
pnpm type-check || {
  echo "❌ Type check failed"
  exit 1
}

# Linting
echo "🧹 Linting..."
pnpm lint:fix || {
  echo "❌ Linting failed"
  exit 1
}

# Format check
echo "💄 Checking formatting..."
pnpm format:check || {
  echo "❌ Format check failed. Running formatter..."
  pnpm format
}

# Security audit
echo "🔒 Security audit..."
pnpm check:security || {
  echo "⚠️ Security vulnerabilities found"
  exit 1
}

# Run staged files through lint-staged
npx lint-staged

echo "✅ All pre-commit checks passed!"